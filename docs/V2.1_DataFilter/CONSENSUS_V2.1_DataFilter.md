# V2.1 æ•°æ®ç­›é€‰å’Œæœç´¢åŠŸèƒ½ - å…±è¯†æ–‡æ¡£

**åˆ›å»ºæ—¥æœŸ**: 2024å¹´12æœˆ  
**åŠŸèƒ½ç‰ˆæœ¬**: V2.1  
**ä¼˜å…ˆçº§**: P0 (æ ¸å¿ƒåŠŸèƒ½)  
**çŠ¶æ€**: å·²ç¡®è®¤

---

## ğŸ“‹ éœ€æ±‚å…±è¯†

### æ˜ç¡®çš„éœ€æ±‚æè¿°

åŸºäºå¯¹ç°æœ‰é¡¹ç›®æ¶æ„çš„æ·±å…¥åˆ†æå’Œéœ€æ±‚ç†è§£ï¼ŒV2.1ç‰ˆæœ¬å°†ä¸ºSNRæ•°æ®å¯è§†åŒ–å·¥å…·æ·»åŠ **æ•°æ®ç­›é€‰å’Œæœç´¢åŠŸèƒ½**ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿï¼š

1. **å‚æ•°èŒƒå›´ç­›é€‰**: æ ¹æ®Pre/Main/Postå‚æ•°å€¼èŒƒå›´ç­›é€‰æ•°æ®ç‚¹
2. **SNRå€¼ç­›é€‰**: æ ¹æ®ä¿¡å™ªæ¯”å€¼èŒƒå›´ç­›é€‰æ•°æ®ç‚¹
3. **ç²¾ç¡®æœç´¢**: å¿«é€Ÿå®šä½ç‰¹å®šå‚æ•°ç»„åˆæˆ–SNRå€¼
4. **ç»“æœå¯è§†åŒ–**: ç­›é€‰ç»“æœåœ¨å›¾è¡¨ä¸­é«˜äº®æ˜¾ç¤º
5. **ç»“æœç®¡ç†**: æŸ¥çœ‹ç­›é€‰ç»Ÿè®¡ã€å¯¼å‡ºç»“æœã€æ¸…é™¤æ¡ä»¶

### åŠŸèƒ½è¾¹ç•Œç¡®è®¤

#### âœ… åŒ…å«åŠŸèƒ½
- å››ç§å‚æ•°çš„èŒƒå›´ç­›é€‰ (Pre/Main/Post/SNR)
- ç²¾ç¡®å€¼æœç´¢å’Œç»„åˆæœç´¢
- ç­›é€‰ç»“æœé«˜äº®æ˜¾ç¤ºå’Œç»Ÿè®¡
- ç­›é€‰æ¡ä»¶ç®¡ç† (åº”ç”¨/æ¸…é™¤)
- ç­›é€‰ç»“æœå¯¼å‡ºåŠŸèƒ½
- ä¸æ‰€æœ‰ç°æœ‰å›¾è¡¨ç±»å‹çš„é›†æˆ

#### âŒ ä¸åŒ…å«åŠŸèƒ½
- å¤æ‚æ•°æ®åˆ†æç®—æ³•
- æœºå™¨å­¦ä¹ åŠŸèƒ½
- å®æ—¶æ•°æ®æµå¤„ç†
- å¤šæ–‡ä»¶æ•°æ®åˆå¹¶
- æ•°æ®åº“è¿æ¥

---

## ğŸ—ï¸ æŠ€æœ¯å®ç°æ–¹æ¡ˆ

### æ¶æ„é›†æˆæ–¹æ¡ˆ

#### 1. æ¨¡å—æ‰©å±•ç­–ç•¥
```python
# åœ¨DataManagerä¸­æ‰©å±•ç­›é€‰åŠŸèƒ½
class DataManager:
    def filter_data(self, filter_criteria: FilterCriteria) -> List[SNRDataPoint]
    def search_data(self, search_params: SearchParams) -> List[SNRDataPoint]
    def get_filter_statistics(self, filtered_data: List[SNRDataPoint]) -> FilterStats

# æ–°å¢ç­›é€‰ç›¸å…³æ•°æ®ç»“æ„
@dataclass
class FilterCriteria:
    pre_range: Optional[Tuple[int, int]] = None
    main_range: Optional[Tuple[int, int]] = None
    post_range: Optional[Tuple[int, int]] = None
    snr_range: Optional[Tuple[float, float]] = None

@dataclass
class SearchParams:
    pre_value: Optional[int] = None
    main_value: Optional[int] = None
    post_value: Optional[int] = None
    snr_value: Optional[float] = None
    tolerance: float = 0.01  # SNRæœç´¢å®¹å·®
```

#### 2. UIç»„ä»¶é›†æˆ
```python
# åœ¨ä¸»ç•Œé¢ä¸­æ·»åŠ ç­›é€‰é¢æ¿
class SNRVisualizerOptimized:
    def create_filter_panel(self) -> tk.Frame
    def on_filter_apply(self, filter_criteria: FilterCriteria)
    def on_filter_clear(self)
    def on_search_execute(self, search_params: SearchParams)
    def update_chart_with_filter(self, filtered_data: List[SNRDataPoint])
```

### æŠ€æœ¯çº¦æŸç¡®è®¤

#### 1. æ¶æ„çº¦æŸ
- âœ… éµå¾ªç°æœ‰åˆ†å±‚æ¶æ„æ¨¡å¼
- âœ… ä½¿ç”¨ç°æœ‰DataManageræ•°æ®æ¥å£
- âœ… ä¿æŒUIå±‚å’Œä¸šåŠ¡é€»è¾‘å±‚åˆ†ç¦»
- âœ… åˆ©ç”¨ç°æœ‰ç¼“å­˜å’Œå¼‚æ­¥å¤„ç†æœºåˆ¶

#### 2. æŠ€æœ¯æ ˆçº¦æŸ
- âœ… ä½¿ç”¨Tkinteræ„å»ºç­›é€‰UIç»„ä»¶
- âœ… ä½¿ç”¨Pandasè¿›è¡Œé«˜æ•ˆæ•°æ®ç­›é€‰
- âœ… ä¿æŒä¸Matplotlibå›¾è¡¨çš„å®Œå…¨å…¼å®¹
- âœ… ä½¿ç”¨ç°æœ‰SNRDataPointæ•°æ®ç»“æ„

#### 3. æ€§èƒ½çº¦æŸ
- âœ… ç­›é€‰æ“ä½œå¼‚æ­¥æ‰§è¡Œï¼Œå“åº”æ—¶é—´ < 100ms
- âœ… æ”¯æŒ10ä¸‡+æ•°æ®ç‚¹çš„é«˜æ•ˆç­›é€‰
- âœ… å†…å­˜ä½¿ç”¨å¢é•¿æ§åˆ¶åœ¨20%ä»¥å†…
- âœ… ä¿æŒUIæµç•…å“åº”æ€§

---

## ğŸ¨ ç”¨æˆ·ç•Œé¢è®¾è®¡

### ç­›é€‰é¢æ¿è®¾è®¡

#### å¸ƒå±€ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®ç­›é€‰é¢æ¿                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‚æ•°ç­›é€‰:                                               â”‚
â”‚   Pre:  [____] - [____]  [åº”ç”¨] [æ¸…é™¤]                  â”‚
â”‚   Main: [____] - [____]  [åº”ç”¨] [æ¸…é™¤]                  â”‚
â”‚   Post: [____] - [____]  [åº”ç”¨] [æ¸…é™¤]                  â”‚
â”‚   SNR:  [____] - [____]  [åº”ç”¨] [æ¸…é™¤]                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¿«é€Ÿæœç´¢:                                               â”‚
â”‚   å‚æ•°å€¼: Pre[___] Main[___] Post[___]  [æœç´¢]           â”‚
â”‚   SNRå€¼:  [_______] Â±[___]              [æœç´¢]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰ç»“æœ: å…± XXX æ¡æ•°æ® (å æ€»æ•°æ® XX.X%)                 â”‚
â”‚   [å…¨éƒ¨æ¸…é™¤] [å¯¼å‡ºç»“æœ] [åº”ç”¨åˆ°å›¾è¡¨]                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### äº¤äº’è®¾è®¡
- **èŒƒå›´è¾“å…¥**: æ•°å­—è¾“å…¥æ¡†ï¼Œæ”¯æŒç©ºå€¼è¡¨ç¤ºæ— é™åˆ¶
- **åº”ç”¨æŒ‰é’®**: ç«‹å³åº”ç”¨å•ä¸ªç­›é€‰æ¡ä»¶
- **æ¸…é™¤æŒ‰é’®**: æ¸…é™¤å•ä¸ªç­›é€‰æ¡ä»¶
- **æœç´¢åŠŸèƒ½**: ç²¾ç¡®å€¼æœç´¢ï¼ŒSNRæ”¯æŒå®¹å·®
- **å…¨éƒ¨æ¸…é™¤**: ä¸€é”®æ¸…é™¤æ‰€æœ‰ç­›é€‰æ¡ä»¶
- **å®æ—¶ç»Ÿè®¡**: æ˜¾ç¤ºç­›é€‰ç»“æœæ•°é‡å’Œå æ¯”

### å›¾è¡¨é«˜äº®è®¾è®¡

#### è§†è§‰æ•ˆæœ
- **ç­›é€‰ç»“æœ**: ä¿æŒåŸå§‹é¢œè‰²ï¼Œæ­£å¸¸é€æ˜åº¦
- **éç­›é€‰æ•°æ®**: ç°è‰²æ˜¾ç¤ºï¼Œé€æ˜åº¦50%
- **è¾¹æ¡†å¼ºè°ƒ**: ç­›é€‰ç»“æœæ•°æ®ç‚¹æ·»åŠ æ·±è‰²è¾¹æ¡†
- **å›¾ä¾‹æ›´æ–°**: æ˜¾ç¤º"ç­›é€‰ç»“æœ"å’Œ"å…¶ä»–æ•°æ®"åˆ†ç±»

---

## âœ… éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶æ ‡å‡†

#### 1. ç­›é€‰åŠŸèƒ½ (å¿…é¡»100%é€šè¿‡)
- [ ] Preå‚æ•°èŒƒå›´ç­›é€‰å‡†ç¡®æ— è¯¯
- [ ] Mainå‚æ•°èŒƒå›´ç­›é€‰å‡†ç¡®æ— è¯¯
- [ ] Postå‚æ•°èŒƒå›´ç­›é€‰å‡†ç¡®æ— è¯¯
- [ ] SNRå€¼èŒƒå›´ç­›é€‰å‡†ç¡®æ— è¯¯
- [ ] å¤šæ¡ä»¶ç»„åˆç­›é€‰é€»è¾‘æ­£ç¡®
- [ ] ç©ºå€¼è¾“å…¥è¡¨ç¤ºæ— é™åˆ¶
- [ ] ç­›é€‰æ¡ä»¶å¯ç‹¬ç«‹åº”ç”¨å’Œæ¸…é™¤

#### 2. æœç´¢åŠŸèƒ½ (å¿…é¡»100%é€šè¿‡)
- [ ] ç²¾ç¡®å‚æ•°å€¼æœç´¢å‡†ç¡®
- [ ] SNRå€¼æœç´¢æ”¯æŒå®¹å·®
- [ ] ç»„åˆæœç´¢é€»è¾‘æ­£ç¡®
- [ ] æœç´¢å“åº”æ—¶é—´ < 100ms
- [ ] æ— åŒ¹é…ç»“æœæ—¶æ­£ç¡®æç¤º

#### 3. æ˜¾ç¤ºåŠŸèƒ½ (å¿…é¡»100%é€šè¿‡)
- [ ] ç­›é€‰ç»“æœåœ¨æ‰€æœ‰å›¾è¡¨ç±»å‹ä¸­æ­£ç¡®é«˜äº®
- [ ] éç­›é€‰æ•°æ®æ­£ç¡®å¼±åŒ–æ˜¾ç¤º
- [ ] ç­›é€‰ç»Ÿè®¡ä¿¡æ¯å‡†ç¡®è®¡ç®—
- [ ] å›¾è¡¨å›¾ä¾‹æ­£ç¡®æ›´æ–°
- [ ] è§†è§‰æ•ˆæœç¾è§‚ä¸“ä¸š

#### 4. äº¤äº’åŠŸèƒ½ (å¿…é¡»100%é€šè¿‡)
- [ ] ç­›é€‰é¢æ¿UIç¾è§‚æ˜“ç”¨
- [ ] æ‰€æœ‰æŒ‰é’®åŠŸèƒ½æ­£å¸¸
- [ ] ç­›é€‰ç»“æœå¯æ­£ç¡®å¯¼å‡ºä¸ºCSV
- [ ] å…¨éƒ¨æ¸…é™¤åŠŸèƒ½æ­£å¸¸
- [ ] ä¸å½±å“ç°æœ‰åŠŸèƒ½æ“ä½œ

### æ€§èƒ½éªŒæ”¶æ ‡å‡† (å¿…é¡»100%é€šè¿‡)
- [ ] 1ä¸‡æ•°æ®ç‚¹ç­›é€‰ < 50ms
- [ ] 10ä¸‡æ•°æ®ç‚¹ç­›é€‰ < 100ms
- [ ] å†…å­˜ä½¿ç”¨å¢é•¿ < 20%
- [ ] UIæ“ä½œä¿æŒæµç•…
- [ ] å¼‚æ­¥å¤„ç†ä¸é˜»å¡ç•Œé¢

### å…¼å®¹æ€§éªŒæ”¶æ ‡å‡† (å¿…é¡»100%é€šè¿‡)
- [ ] çº¿å›¾ç­›é€‰æ˜¾ç¤ºæ­£å¸¸
- [ ] çƒ­å›¾ç­›é€‰æ˜¾ç¤ºæ­£å¸¸
- [ ] å…¨é…ç½®å›¾ç­›é€‰æ˜¾ç¤ºæ­£å¸¸
- [ ] 3Dæ•£ç‚¹å›¾ç­›é€‰æ˜¾ç¤ºæ­£å¸¸
- [ ] ä¸ç°æœ‰ç¼“å­˜æœºåˆ¶å…¼å®¹
- [ ] ä¸ç°æœ‰å¼‚æ­¥å¤„ç†å…¼å®¹
- [ ] ä¸ç ´åä»»ä½•ç°æœ‰åŠŸèƒ½

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ•°æ®ç­›é€‰ç®—æ³•
```python
def filter_data(self, data: List[SNRDataPoint], criteria: FilterCriteria) -> List[SNRDataPoint]:
    """
    é«˜æ•ˆæ•°æ®ç­›é€‰å®ç°
    ä½¿ç”¨Pandas DataFrameè¿›è¡Œå‘é‡åŒ–æ“ä½œ
    """
    df = pd.DataFrame([asdict(point) for point in data])
    
    # åº”ç”¨ç­›é€‰æ¡ä»¶
    mask = pd.Series([True] * len(df))
    
    if criteria.pre_range:
        mask &= (df['pre'] >= criteria.pre_range[0]) & (df['pre'] <= criteria.pre_range[1])
    if criteria.main_range:
        mask &= (df['main'] >= criteria.main_range[0]) & (df['main'] <= criteria.main_range[1])
    if criteria.post_range:
        mask &= (df['post'] >= criteria.post_range[0]) & (df['post'] <= criteria.post_range[1])
    if criteria.snr_range:
        mask &= (df['snr'] >= criteria.snr_range[0]) & (df['snr'] <= criteria.snr_range[1])
    
    filtered_df = df[mask]
    return [SNRDataPoint(**row) for _, row in filtered_df.iterrows()]
```

### ç¼“å­˜ç­–ç•¥
```python
def get_filter_cache_key(self, criteria: FilterCriteria) -> str:
    """
    ç”Ÿæˆç­›é€‰ç»“æœç¼“å­˜é”®
    """
    return f"filter_{hash(str(criteria))}"

def get_cached_filter_result(self, criteria: FilterCriteria) -> Optional[List[SNRDataPoint]]:
    """
    è·å–ç¼“å­˜çš„ç­›é€‰ç»“æœ
    """
    cache_key = self.get_filter_cache_key(criteria)
    return self.cache.get(cache_key)
```

### å¼‚æ­¥å¤„ç†
```python
async def apply_filter_async(self, criteria: FilterCriteria):
    """
    å¼‚æ­¥æ‰§è¡Œç­›é€‰æ“ä½œ
    """
    # æ£€æŸ¥ç¼“å­˜
    cached_result = self.get_cached_filter_result(criteria)
    if cached_result:
        return cached_result
    
    # æ‰§è¡Œç­›é€‰
    filtered_data = await asyncio.to_thread(self.filter_data, self.current_data, criteria)
    
    # ç¼“å­˜ç»“æœ
    cache_key = self.get_filter_cache_key(criteria)
    self.cache[cache_key] = filtered_data
    
    return filtered_data
```

---

## ğŸ“Š æˆåŠŸæŒ‡æ ‡

### åŠŸèƒ½æŒ‡æ ‡
- âœ… æ‰€æœ‰ç­›é€‰åŠŸèƒ½100%æ­£å¸¸å·¥ä½œ
- âœ… æ‰€æœ‰æœç´¢åŠŸèƒ½100%æ­£å¸¸å·¥ä½œ
- âœ… æ‰€æœ‰å›¾è¡¨ç±»å‹100%æ”¯æŒç­›é€‰æ˜¾ç¤º
- âœ… ç­›é€‰ç»“æœå¯¼å‡ºåŠŸèƒ½100%æ­£å¸¸

### æ€§èƒ½æŒ‡æ ‡
- âœ… ç­›é€‰å“åº”æ—¶é—´ < 100ms (10ä¸‡æ•°æ®ç‚¹)
- âœ… å†…å­˜ä½¿ç”¨å¢é•¿ < 20%
- âœ… UIå“åº”æ€§ä¿æŒæµç•…
- âœ… ä¸å½±å“ç°æœ‰åŠŸèƒ½æ€§èƒ½

### ç”¨æˆ·ä½“éªŒæŒ‡æ ‡
- âœ… ç­›é€‰é¢æ¿UIç¾è§‚ä¸“ä¸š
- âœ… æ“ä½œæµç¨‹ç›´è§‚æ˜“æ‡‚
- âœ… ç­›é€‰ç»“æœè§†è§‰æ•ˆæœæ¸…æ™°
- âœ… é”™è¯¯å¤„ç†å‹å¥½

### ä»£ç è´¨é‡æŒ‡æ ‡
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œéµå¾ªç°æœ‰è§„èŒƒ
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 90%
- âœ… æ–‡æ¡£å®Œæ•´å‡†ç¡®
- âœ… æ— æŠ€æœ¯å€ºåŠ¡å¼•å…¥

---

## ğŸš€ äº¤ä»˜ç¡®è®¤

### äº¤ä»˜ç‰©æ¸…å•
- [ ] ç­›é€‰åŠŸèƒ½æ ¸å¿ƒä»£ç 
- [ ] UIç»„ä»¶å®ç°ä»£ç 
- [ ] å•å…ƒæµ‹è¯•ä»£ç 
- [ ] åŠŸèƒ½æ¼”ç¤ºå’Œæµ‹è¯•
- [ ] ç”¨æˆ·æ–‡æ¡£æ›´æ–°
- [ ] æŠ€æœ¯æ–‡æ¡£æ›´æ–°

### æœ€ç»ˆç¡®è®¤
- [ ] æ‰€æœ‰éªŒæ”¶æ ‡å‡†100%é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡
- [ ] ç”¨æˆ·éªŒæ”¶æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å®¡æŸ¥é€šè¿‡

---

*æ–‡æ¡£åˆ›å»ºæ—¥æœŸ: 2024å¹´12æœˆ*  
*æœ€åæ›´æ–°: 2024å¹´12æœˆ*  
*çŠ¶æ€: å·²ç¡®è®¤ï¼Œå‡†å¤‡è¿›å…¥æ¶æ„è®¾è®¡é˜¶æ®µ*